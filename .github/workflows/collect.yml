name: collect-note-stats
on:
  schedule:
    - cron: "7 */3 * * *"   # 3時間おき（分を7にずらしてスパイク回避）
  workflow_dispatch: {}
jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      - name: Jitter
        run: sleep $((RANDOM % 900))   # 0〜15分ランダム待機
      - run: pip install requests
      - run: python collector.py
        env:
          NOTE_COOKIE: ${{ secrets.NOTE_COOKIE }}
          NOTE_XSRF:   ${{ secrets.NOTE_XSRF }}
          INGEST_URL:  ${{ secrets.INGEST_URL }}
          API_KEY:     ${{ secrets.API_KEY }}
